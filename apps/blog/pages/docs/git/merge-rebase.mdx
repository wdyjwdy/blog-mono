import { Picture } from '@/components'
import { Callout } from 'nextra/components'
import { Table } from '@radix-ui/themes';

# Merge & Rebase
## Merge
### åˆå¹¶ä¸¤ä¸ªåˆ†æ”¯
```mermaid
%%{init: { 'theme': 'base'}}%%
gitGraph
    commit
    commit id: "A"
    branch feat
    checkout main
    commit
    commit id: "B"
    checkout feat
    commit
    commit id: "C"
    checkout main
    merge feat
    commit
```
1. åœ¨ `main` åˆ†æ”¯ä¸Šæ‰§è¡Œ `git merge feat{:sh}` å‘½ä»¤ï¼Œå°† `feat` åˆå…¥ `main`
2. Git ä¼šå°† `A`, `B`, `C` åšä¸€ä¸ª[ä¸‰æ–¹åˆå¹¶](#ä¸‰æ–¹åˆå¹¶)ï¼Œç„¶åæäº¤åˆå¹¶çš„ç»“æœ
<Callout type='error'>
ç¼ºç‚¹ï¼šæäº¤å†å²æ˜¯éçº¿æ€§çš„ï¼Œå¹¶ä¸”ä¼šå¼•å…¥ä¸€æ¬¡æ–°çš„æäº¤ã€‚
</Callout>
## Rebase
### åˆå¹¶å¤šä¸ªæäº¤
1. ä½¿ç”¨ `git log --oneline{:sh}` å‘½ä»¤ï¼ŒæŸ¥çœ‹å†å²æäº¤
```sh
78854e7 (HEAD -> main) ç”˜è”—
62e3f2e é›ªæ¢¨
59dfed7 æ©™å­
77cc3ec ä¹‹å‰çš„æäº¤
```
2. ç„¶åä½¿ç”¨ `git rebase -i HEAD~3{:sh}` å‘½ä»¤ï¼Œåˆå¹¶æœ€è¿‘ä¸‰ä¸ªæäº¤ï¼Œä¼šå¼¹å‡ºå¦‚ä¸‹äº¤äº’ç•Œé¢
```sh
pick 59dfed7 æ©™å­ # æœ€æ—©çš„ commit
pick 62e3f2e é›ªæ¢¨
pick 78854e7 ç”˜è”—

# p, pick, ä¿ç•™ commit
# s, squash, åˆå¹¶å…¥ä¹‹å‰çš„ commit
```
3. å°† `é›ªæ¢¨` å’Œ `ç”˜è”—` åˆå¹¶å…¥ `æ©™å­`ï¼Œå³å°† `pick` æ”¹ä¸º `s`ï¼Œä¿å­˜åå¡«å†™æ–°çš„æäº¤ä¿¡æ¯ `æ°´æœ`
```sh
pick 59dfed7 æ©™å­ # æœ€æ—©çš„ commit
s 62e3f2e é›ªæ¢¨
s 78854e7 ç”˜è”—
```
4. åˆå¹¶å®Œæˆ
```sh
78854e7 (HEAD -> main) æ°´æœ
77cc3ec ä¹‹å‰çš„æäº¤
```
### çº¿æ€§ä¸‰æ–¹åˆå¹¶
```mermaid
%%{init: { 'theme': 'base'}}%%
gitGraph
    commit
    commit id: "A"
    branch feat
    checkout main
    commit
    commit id: "B"
    checkout feat
    commit
    commit id: "C"
```
1. é¦–å…ˆåœ¨ `feat` åˆ†æ”¯ä¸Šæ‰§è¡Œ `git rebase main{:sh}` å‘½ä»¤ï¼Œå°† `feat` åˆ†æ”¯å˜åŸºåˆ° `main` åˆ†æ”¯ï¼ˆä»åŸºäº `A` å˜æˆåŸºäº `B`ï¼‰
```mermaid
%%{init: { 'theme': 'base'}}%%
gitGraph
    commit
    commit id: "A"
    commit
    commit id: "B"
    branch feat
    checkout feat
    commit
    commit id: "C'"
```
2. åœ¨ `main` åˆ†æ”¯ä¸Šæ‰§è¡Œ `git merge feat{:sh}` å‘½ä»¤ï¼Œå°† `feat` åˆå…¥ `main`ï¼ˆè¿™é‡Œæ˜¯ä¸€ä¸ª[å¿«é€Ÿåˆå¹¶](#å¿«é€Ÿåˆå¹¶)ï¼Œå› æ­¤è®°å½•æ˜¯çº¿æ€§çš„ï¼‰
<Callout type='error'>
ç¼ºç‚¹ï¼šå› ä¸ºæ˜¯åŸºäº `B` é‡æ–°æäº¤ `C`ï¼Œæ‰€ä»¥éœ€è¦è§£å†³å¤šæ¬¡å†²çªã€‚
</Callout>
## Appendix
### ä¸¤æ–¹åˆå¹¶
```mermaid
%%{init: { 'theme': 'base'}}%%
gitGraph
    commit
    commit id: "A"
    branch feat
    checkout main
    commit
    commit id: "B"
    checkout feat
    commit
    commit id: "C"
    checkout main
    merge feat
    commit
```
æˆ‘ä»¬æƒ³è¦å°† `feat` åˆå…¥ `main`ï¼Œä½†æ˜¯ä»…ä»…å¯¹æ¯” `B`, `C` ï¼Œæˆ‘ä»¬æ— æ³•çŸ¥é“æ˜¯è°ä¿®æ”¹äº†æ–‡ä»¶ï¼Œæ‰€ä»¥åªèƒ½æ‰‹åŠ¨åˆå¹¶
### ä¸‰æ–¹åˆå¹¶
```mermaid
%%{init: { 'theme': 'base'}}%%
gitGraph
    commit
    commit id: "A"
    branch feat
    checkout main
    commit
    commit id: "B"
    checkout feat
    commit
    commit id: "C"
    checkout main
    merge feat
    commit
```
ä¸‰æ–¹åˆå¹¶å¼•å…¥äº† `B`, `C` çš„å…±åŒçˆ¶èŠ‚ç‚¹ `A`ï¼Œå¯¹æ¯”å¯ä»¥ç¡®å®šæ˜¯ `B` ä¿®æ”¹äº†æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥è‡ªåŠ¨åˆå¹¶

<Table.Root variant="surface" style={{ marginTop: "10px" }}>
  <Table.Header>
    <Table.Row>
      <Table.ColumnHeaderCell>Diff</Table.ColumnHeaderCell>
      <Table.ColumnHeaderCell>Result</Table.ColumnHeaderCell>
    </Table.Row>
  </Table.Header>

  <Table.Body>
    <Table.Row>
      <Table.Cell>`A` = `B` = `C`</Table.Cell>
      <Table.Cell>å†…å®¹æ— ä¿®æ”¹ï¼Œä¿ç•™ `A` æˆ– `B` æˆ– `C`</Table.Cell>
    </Table.Row>
    <Table.Row>
      <Table.Cell>`A` = `B` â‰  `C`</Table.Cell>
      <Table.Cell>`C` è¿›è¡Œäº†ä¿®æ”¹ï¼Œä¿ç•™ `C`</Table.Cell>
    </Table.Row>
    <Table.Row>
      <Table.Cell>`A` = `C` â‰  `B`</Table.Cell>
      <Table.Cell>`B` è¿›è¡Œäº†ä¿®æ”¹ï¼Œä¿ç•™ `B`</Table.Cell>
    </Table.Row>
    <Table.Row>
      <Table.Cell>`B` = `C` â‰  `A`</Table.Cell>
      <Table.Cell>`B`, `C` è¿›è¡Œäº†ç›¸åŒçš„ä¿®æ”¹ï¼Œä¿ç•™ `B` æˆ– `C`</Table.Cell>
    </Table.Row>
    <Table.Row>
      <Table.Cell>`A` â‰  `B` â‰  `C`</Table.Cell>
      <Table.Cell>å‘ç”Ÿå†²çªï¼Œæ‰‹åŠ¨ä¿ç•™</Table.Cell>
    </Table.Row>
  </Table.Body>
</Table.Root>
### å¿«é€Ÿåˆå¹¶
```mermaid
%%{init: { 'theme': 'base'}}%%
%%{init: { 'theme': 'base'}}%%
gitGraph
    commit
    commit
    commit
    commit id: "A"
    branch feature
    checkout feature
    commit
    commit
    commit id: "C"
```
åšä¸‰æ–¹åˆå¹¶æ—¶ï¼Œå¦‚æœ `main` ä¸Šæ²¡æœ‰æ–°çš„æäº¤ï¼Œå°±ä¸ä¼šäº§ç”Ÿå†²çªï¼ŒGit ä¼šç›´æ¥å°† `main` æŒ‡é’ˆå‰ç§»åˆ° `C`
<Callout type='info' emoji='ğŸ³'>
å¿«é€Ÿåˆå¹¶ä¸ä¼šäº§ç”Ÿæ–°çš„æäº¤ï¼Œå¹¶ä¸”è®°å½•æ˜¯çº¿æ€§çš„ã€‚
</Callout>